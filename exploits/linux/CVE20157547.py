"""
CVE 2016 2870
"""
import os
import subprocess
from constants import MEDIUM_RELIABILITY, UBUNTU_12_LTS, UBUNTU_14_LTS, UBUNTU_15, POTENTIALLY_VULNERABLE, \
	DEBIAN_7, DEBIAN_8, color_print
from src.kernels import KernelWindow

class CVE20157547:
	def __init__(self):
		self.name = "CVE-2015-7547"
		self.type = "linux"
		self.brief_desc = "stack-based buffer overflows in glibc < 2.23 can cause privilege escalation"
		self.reliability = MEDIUM_RELIABILITY
		self.vulnerable_kernels = [
			KernelWindow(UBUNTU_15, POTENTIALLY_VULNERABLE, 0, 0, 0, 2, 21, 0),
			KernelWindow(UBUNTU_14_LTS, POTENTIALLY_VULNERABLE, 0, 0, 0, 2, 19, 0),
			KernelWindow(UBUNTU_12_LTS, POTENTIALLY_VULNERABLE, 0, 0, 0, 2, 21, 0),
			KernelWindow(DEBIAN_7, POTENTIALLY_VULNERABLE, 0, 0, 0, 2, 13, 38),
			KernelWindow(DEBIAN_8, POTENTIALLY_VULNERABLE, 0, 0, 0, 2, 19, 18)
		]

	def determine_vulnerability(self):
		color_print("\t[*] checking exploitation prerequisites for {}".format(self.name), color="blue")
		# if kernel matches...it should be vulnerable
		color_print("\t[+] system appears to be vulnerable to {}".format(self.name), color="green")
		return True